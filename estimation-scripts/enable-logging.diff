Index: src/ktorrentviewitem.cpp
===================================================================
--- src/ktorrentviewitem.cpp	(revision 468859)
+++ src/ktorrentviewitem.cpp	(working copy)
@@ -25,6 +25,7 @@
 #include <math.h>
 #include "ktorrentviewitem.h"
 #include "functions.h"
+#include <libutil/log.h>
 
 using namespace bt;
 
@@ -77,6 +78,9 @@
 KTorrentViewItem::KTorrentViewItem(QListView* parent,bt::TorrentControl* tc)
 	: KListViewItem(parent),tc(tc)
 {
+	toLog = true;
+	counter = 1;
+	started = false;
 	update();
 }
 
@@ -86,6 +90,7 @@
 
 void KTorrentViewItem::update()
 {
+	bool tmpLog = true;
 	/*
 	addColumn(i18n("File"));
 	addColumn(i18n("Status"));
@@ -114,8 +119,43 @@
 	setText(6,KBytesPerSecToString(tc->getUploadRate() / 1024.0));
   
 	KLocale* loc = KGlobal::locale();
+
+ 	
+ 	if(counter==1)
+ 	{
+ 		if (tc->isRunning())
+ 		{
+ 			if(!started)
+ 			{
+ 				Out() << "{" << tc->getTorrentName() << "}," << QDateTime::currentDateTime().toTime_t() << "," << tc->getDownloadRate() << "," << tc->getBytesDownloaded() << "," << tc->getBytesLeft() << "," << tc->getNumPeers() << ",ACTIVATED" << endl;
+ 				tmpLog = false;
+ 				started = true;
+ 				toLog = true;
+ 			}
+ 		}
+ 		
+ 		if(!tc->isRunning())
+ 		{
+ 			if(started)
+ 			{
+ 				Out() << "{" << tc->getTorrentName() << "}," << QDateTime::currentDateTime().toTime_t() << "," << tc->getDownloadRate() << "," << tc->getBytesDownloaded() << "," << tc->getBytesLeft() << "," << tc->getNumPeers() << ",DEACTIVATED" <<endl;
+ 				tmpLog = false;
+ 				started = false;
+ 			}
+ 			toLog = false;
+ 		}
+ 	}
+ 	
+ 	if(counter!=1) tmpLog=false;
+	counter *= -1;
+
+
 	if (tc->getBytesLeft() == 0)
 	{
+ 		if(toLog && tmpLog) 
+ 			Out() << "{" << tc->getTorrentName() << "}," << QDateTime::currentDateTime().toTime_t() << "," << tc->getDownloadRate() << "," << tc->getBytesDownloaded() << "," << 0 << "," << tc->getNumPeers() << ",FINISHED" << endl;
+ 		toLog = false;
+
 		setText(7,i18n("finished"));
 	}
 	else 
@@ -124,9 +164,16 @@
 		if( bytes_downloaded < 1 ) //if we just started download use old algorithm
 		{
 			if (tc->getDownloadRate() == 0)
+			{
+ 				if(toLog && tmpLog) 
+ 					Out() << "{" << tc->getTorrentName() << "}," << QDateTime::currentDateTime().toTime_t() << "," << 0 << "," << tc->getBytesDownloaded() << "," << tc->getBytesLeft() << "," << tc->getNumPeers() << ",RUNNING" << endl;
 				setText(7,i18n("infinity"));
+			}
 			else
 			{
+				if(toLog && tmpLog) 
+ 					Out() << "{" << tc->getTorrentName() << "}," << QDateTime::currentDateTime().toTime_t() << "," << tc->getDownloadRate() << "," << tc->getBytesDownloaded() << "," << tc->getBytesLeft() << "," << tc->getNumPeers() << ",RUNNING" << endl;
+
 				Uint32 secs = (int)floor( (float)tc->getBytesLeft() / (float)tc->getDownloadRate() );
 				QTime t;
 				t = t.addSecs(secs);
Index: src/ktorrentviewitem.h
===================================================================
--- src/ktorrentviewitem.h	(revision 468859)
+++ src/ktorrentviewitem.h	(working copy)
@@ -41,6 +41,10 @@
 	void update();
 
 private:
+	bool toLog;
+	int counter;
+	bool started;
+	uint start_timestamp;
 	int compare(QListViewItem * i,int col,bool ascending) const;
 	void paintCell(QPainter* p,const QColorGroup & cg,int column,int width,int align);
 
